# Learning Directory

このディレクトリは、Weaverプロジェクトの学習用タスク管理に使用します。

---

## 📌 重要：v1 と v2 について

Weaver プロジェクトは **2つのバージョン**で構成されています：

### v1（完了）: 学習用プロトタイプ
- **目的**: Rust の基礎学習（async, 所有権, 関数型パターン）
- **アーキテクチャ**: 単一プロセス、インメモリ実装
- **完了フェーズ**: Phase 1〜4（タスク分解まで）
- **タスク管理**: `tasks_v1/tasks.md`
- **学習記録**: `tasks_v1/learning_YYYY_MM_DD.md`

### v2（現在）: 本格的分散システム実装
- **目的**: 実運用可能なタスク実行エンジン
- **アーキテクチャ**: PostgreSQL 正本 + Redis 配送 + Blob storage
- **実装計画**: 2週間（Week 1: 骨格と Typed API、Week 2: 永続化と配送）
- **タスク管理**: `tasks.md`（本ファイルと同じディレクトリ）
- **学習記録**: `learning_YYYY_MM_DD.md`（本ファイルと同じディレクトリ）

---

## 🎯 目的

- Rustの非同期処理、所有権/ライフタイム、関数型プログラミングの学習
- 分散システム設計パターン（Outbox, Lease, Ports & Adapters）の実践
- 実装を通じた理解の深化
- 学習履歴と進捗の記録

---

## 📂 ファイル管理方式

**タスク管理**と**実装記録**を分離して管理します。

```
dev/learning/
├── README.md                    # このファイル（ディレクトリの使い方）
├── tasks.md                     # v2 タスクリスト（マスター）
├── learning_2026_01_04.md       # 2026年1月4日の実装記録（v2）
├── learning_2026_01_05.md       # 2026年1月5日の実装記録（v2）
└── tasks_v1/                    # v1 アーカイブ
    ├── tasks.md                 # v1 タスクリスト
    ├── learning_2025_12_28.md   # v1 実装記録（Phase 1）
    ├── learning_2025_12_29.md   # v1 実装記録（Phase 2）
    └── ...
```

### ファイルの役割

#### `tasks.md` - v2 タスクマスターリスト
- v2 実装の全タスクを一元管理（Week 1〜2、PR-1〜14）
- 各タスクの完了状態（✅ ⏳ 🔄）
- PR ごとのゴールと学習ポイント
- **このファイルを見れば、v2 プロジェクト全体の進捗が分かる**

#### `learning_YYYY_MM_DD.md` - 日次実装記録（v2）
- その日に実装した内容の詳細
- 学んだこと、つまづいた点、解決方法
- コードスニペットと説明
- **時系列で振り返る際に使用**

#### `tasks_v1/` - v1 アーカイブ
- v1 実装の完了記録（参考用）
- v2 との比較、アーキテクチャの違いを理解する際に活用

---

## 🛠️ 使い方

### タスクを確認する
→ `tasks.md` を開く（v2 の現在のタスクリスト）

### 今日の作業を記録する
→ `learning_YYYY_MM_DD.md`（今日の日付）に実装記録を追加

### 過去の実装を振り返る
→ 該当日付のファイルを開く
→ v1 の記録は `tasks_v1/learning_YYYY_MM_DD.md`

### タスクを完了したら
1. `tasks.md` で該当タスクを `[x]` にする
2. 日次ファイルに実装記録を書く
3. 学んだことを「★ Insight」形式でまとめる

---

## 💡 Claude Code への指示

**重要**: このディレクトリ内のタスクは**学習用**です。

### Do（推奨される行動）
- ✅ 質問や実装のヒントを積極的に提供
- ✅ コードレビューとフィードバック
- ✅ 設計の説明と選択肢の提示
- ✅ 「Learn by Doing」形式での学習サポート
- ✅ TODO(human) マーカーでの学習機会提供

### Don't（避けるべき行動）
- ❌ ユーザーの明示的な依頼なしに自動実装
- ❌ 学習機会を奪う完全な実装の提供
- ❌ 説明なしのコード提示

### 協働スタイル
- 段階的ヒント：概念 → パターン → コード例の順
- 質問を促す：各段階で理解度を確認
- 一緒に実装：ユーザーが望む場合はペアプログラミング形式

---

## 📖 参考ドキュメント

学習タスクは以下のドキュメントに基づいています：

### 要件定義
- **v2（現在）**: `dev/docs/requirements/2026_01_03_weaver_requirements.md`
- **v1（参考）**: `dev/docs/requirements/2025_12_27_weaver_requirements.md`

**重要**: 常に最新日付の要件ドキュメントを参照してください

### アーキテクチャ・開発ガイド
- `CLAUDE.md` - プロジェクト概要とアーキテクチャ
- `dev/docs/adr/` - アーキテクチャ決定記録（ADR）
  - ADR-0003: Never await while holding locks（必読）
  - ADR-0005: Decider architecture（v1で学習済み）

### スキル
- **weaver-context**: アーキテクチャ詳細、コマンド、開発ノート
  - 使用例: `/weaver-context [質問内容]`

---

## 🎓 学習の進め方（v2）

### Week 1: 骨格と Typed API（6 PR）
1. Module tree 移行（Ports & Adapters パターン）
2. ULID + IdGenerator/Clock（分散システムの基礎）
3. Typed Task API（型安全性）
4. DispatchStrategy（拡張性）
5. 起動時検証（開発体験）
6. InMemoryDeliveryQueue（開発用実装）

### Week 2: 永続化と配送（8 PR）
7. Postgres TaskStore（正本）
8. OutboxPublisherLoop（配送の確実化）
9. RedisDeliveryQueue（本番配送）
10. WorkerLoop（実行エンジン）
11. LeaseReaperLoop（at-least-once 保証）
12. ArtifactStore + TTL/GC（Blob 管理）
13. Repair フロー（自動復旧）
14. Docker Compose + E2E テスト（統合動作確認）

### 各 PR で学ぶこと
- **実装前**: 設計意図を理解、選択肢を検討
- **実装中**: Rust パターンの実践、エラーとの格闘
- **実装後**: テスト作成、振り返り、学びの言語化

### 学習記録のフォーマット（推奨）

```markdown
## PR-N: [タスク名]（実装日: YYYY-MM-DD）

### 🎯 目的
[このタスクで何を達成するか]

### 📝 実装内容
- [実装した機能/モジュール]
- [主要な設計判断]

### 🔍 学んだこと
- **技術的発見**: [Rust の機能、パターン]
- **設計の洞察**: [アーキテクチャ、トレードオフ]
- **つまづいた点**: [エラー、解決方法]

### ★ Insight
[2-3個の重要な学び]
```

---

## 🚀 開始するには

1. **v2 要件ドキュメントを読む**
   - `dev/docs/requirements/2026_01_03_weaver_requirements.md`
   - 特に「合意済みの大方針」「v2 の目標・非目標」「実装計画」

2. **tasks.md を確認**
   - 現在のタスク（Week 1: PR-1〜）
   - 学習ポイントの把握

3. **PR-1 から開始**
   - Module tree 移行（v1 → v2 アーキテクチャ）
   - 質問があれば Claude Code に相談

4. **日次記録を残す**
   - `learning_2026_01_04.md`（実装開始日）を作成
   - 実装内容と学びを記録

---

## ❓ よくある質問

### Q: v1 のコードはどうなるの？
A: v2 で段階的に置き換えていきます。最初は module tree を再構成し、互換性を保ちながら移行します。

### Q: v1 で学んだことは無駄になる？
A: いいえ！v1 で学んだ基礎（async, 所有権, Decider パターン）は v2 でも活用します。

### Q: どのくらいの期間で完了する？
A: v2 要件では「2週間」を想定していますが、学習ペースに合わせて調整してください。

### Q: 詰まったら？
A: いつでも Claude Code に質問してください。設計レビュー、実装ヒント、デバッグサポートを提供します。

---

**Let's build Weaver v2! 🎉**
